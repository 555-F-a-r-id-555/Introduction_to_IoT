### –ö–∏–±–µ—Ä–Ω–µ—Ç–∏–∫–∞ —É–º–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
### –î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ 1
```txt
–£—Å–ª–æ–≤–∏–µ:
‚óè –ó–∞–∫—Ä–µ–ø–∏—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª—ã –ø—Ä–∞–∫—Ç–∏–∫—É–º–∞ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ–º –≤—Å–µ—Ö
–¥–µ–π—Å—Ç–≤–∏–π –∏–∑ –º–µ—Ç–æ–¥–∏—á–∫–∏ –∏–ª–∏ –∑–∞–ø–∏—Å–∏ –≤–µ–±–∏–Ω–∞—Ä–∞.

‚óè –ü—Ä–∏—Å–ª–∞—Ç—å —Ä–µ–∫–≤–∏–∑–∏—Ç—ã –¥–æ—Å—Ç—É–ø–∞ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç–æ–π —Å–∏—Å—Ç–µ–º—ã
–≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ —Å –∞–∫—Ç—É–∞–ª—å–Ω—ã–º–∏ –∏ –≤–∞–ª–∏–¥–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏. –ï—Å–ª–∏
–Ω–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –≤—ã—Ö–æ–¥ —Å–∏—Å—Ç–µ–º—ã –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç,
–º–æ–∂–Ω–æ –ø—Ä–∏—Å—Ç–∞—Ç—å —Å–∫—Ä–∏–Ω—à–æ—Ç—ã —Å –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞.

‚óè –û–ø–∏—Å–∞—Ç—å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏, —Å –∫–æ—Ç–æ—Ä—ã–º–∏ —Å—Ç–æ–ª–∫–Ω—É–ª–∏—Å—å –ø—Ä–∏
—Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–∏



–ü—Ä–∏–º–µ—Ä —Ä–µ—à–µ–Ω–∏—è: —Å–º. —Å–µ–º–∏–Ω–∞—Ä
–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–µ–π –ø–æ –æ—Ü–µ–Ω–∫–µ –∑–∞–¥–∞–Ω–∏—è:
–†–∞–±–æ—Ç–∞ —Å—á–∏—Ç–∞–µ—Ç—Å—è —Å–¥–∞–Ω–Ω–æ–π, –µ—Å–ª–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã —Å–ª–µ–¥—É—é—â–∏–µ –ø—É–Ω–∫—Ç—ã:
‚óè –≤—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –¥–æ—Å—Ç—É–ø–Ω—ã –∏–∑–≤–Ω–µ
—á–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç (–µ—Å–ª–∏ —É —Å—Ç—É–¥–µ–Ω—Ç–∞ –±—ã–ª–∞ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Å–¥–µ–ª–∞—Ç—å
–≤—ã—Ö–æ–¥ —Å–∏—Å—Ç–µ–º—ã —Å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç) - –Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ, –µ—Å–ª–∏ —É —Å—Ç—É–¥–µ–Ω—Ç–∞
–º–æ–∂–µ—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞—Ç—å —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å.
‚óè –≤—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—ã –ª–æ–∫–∞–ª—å–Ω–æ
(–Ω—É–∂–Ω—ã —Å–∫—Ä–∏–Ω—à–æ—Ç—ã). - –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ
‚óè –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω—ã —Å–∫—Ä–∏–Ω—à–æ—Ç—ã —Ä–∞–±–æ—Ç—ã –ø–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—é –¥–∞–Ω–Ω—ã—Ö.
- –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æS

```

Steps:
<details> <summary>–ü–æ–∫–∞–∑–∞—Ç—å —Å–ø–∏—Å–æ–∫ –∫–æ–º–∞–Ω–¥ (–ù–∞–∂–º–∏, —á—Ç–æ–±—ã —Ä–∞—Å–∫—Ä—ã—Ç—å)</summary>

```sh
#!/bin/bash 

_______________________________________________________________________________

cat > /etc/default/grub <<EOF
GRUB_DEFAULT=0
GRUB_TIMEOUT=0
GRUB_DISTRIBUTOR=`lsb_release -i -s 2> /dev/null || echo Debian`
GRUB_CMDLINE_LINUX_DEFAULT="quiet text mitigations=off nowatchdog processor.ignore_ppc=1 cpufreq.default_governor=performance ipv6.disable=1 apparmor=0 selinux=0 debug=-1"
GRUB_CMDLINE_LINUX=""
GRUB_DISABLE_LINUX_RECOVERY=true
GRUB_DISABLE_OS_PROBER=true
GRUB_TERMINAL=console
EOF


echo "net.ipv4.ip_forward=1" >> /etc/sysctl.conf && \
echo "net.ipv4.conf.all.forwarding=1" >> /etc/sysctl.conf && \
sysctl -p /etc/sysctl.conf && \
systemctl stop cron && \
systemctl stop apparmor && \
systemctl stop console-setup && \
systemctl stop keyboard-setup && \
systemctl disable cron && \
systemctl disable apparmor && \
systemctl disable console-setup && \
systemctl disable keyboard-setup && \
systemctl set-default multi-user.target && \
apt install -y sudo curl wget gnupg2 systemd-timesyncd htop && \
sed -i 's/#NTP=/NTP=1.ru.pool.ntp.org/' /etc/systemd/timesyncd.conf && \
systemctl restart systemd-timesyncd && \
update-grub && \
reboot

df -h
_______________________________________________________________________________

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Mosquitto 2.0.18 + –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ 

sudo apt install -y mosquitto mosquitto-clients
sudo mosquitto_passwd -c /etc/mosquitto/passwd IoT && \
sudo chmod 777 /etc/mosquitto/passwd
123
123

sudo cat > /etc/mosquitto/conf.d/default.conf <<EOF
allow_anonymous false
password_file /etc/mosquitto/passwd
listener 1883
EOF


sudo systemctl restart mosquitto

mosquitto_sub -h 192.168.42.130 -p 1883 -t GB -u "IoT" -P "123"

mosquitto_pub -h 192.168.42.130 -p 1883 -t GB -m "Hello, GB!" -u "IoT" -P "123"

mosquitto_pub -h 192.168.42.130 -p 1883 -t GB -m "Hello agin" -u "IoT" -P "123"
mosquitto_pub -h 192.168.42.130 -p 1883 -t GB -m "2222.5" -u "IoT" -P "123"

_______________________________________________________________________________

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Node.js 20 + node-red + –∞–¥–º–∏–Ω–∫–∞


sudo apt-get update && sudo apt-get install -y ca-certificates curl gnupg && \
curl -fsSL https://deb.nodesource.com/gpgkey/nodesource-repo.gpg.key | sudo gpg --dearmor -o /etc/apt/keyrings/nodesource.gpg && \
NODE_MAJOR=22 && \
echo "deb [signed-by=/etc/apt/keyrings/nodesource.gpg] https://deb.nodesource.com/node_$NODE_MAJOR.x nodistro main" | sudo tee /etc/apt/sources.list.d/nodesource.list && \
sudo apt-get update && sudo apt-get install nodejs -y && \
bash <(curl -sL https://raw.githubusercontent.com/node-red/linux-installers/master/deb/update-nodejs-and-nodered) && \
sudo systemctl enable nodered && \
sudo systemctl start nodered

# '–£—Å—Ç–Ω–æ–≤–∏—Ç—å –ø–∞–ª–∏—Ç—Ä—É node-red-contrib-influxdb node-red-node-random/random-generator_node-red-contrib'
# admin
# darfie2211
# user
# darfie2211

# http://192.168.42.130:1880/

_______________________________________________________________________________


# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ WireGuard
sudo curl -O https://raw.githubusercontent.com/angristan/wireguard-install/master/wireguard-install.sh && \
sudo chmod +x wireguard-install.sh && \
sudo ./wireguard-install.sh

sudo nano /etc/wireguard/wg0.conf
'remove all ipv6'

sudo systemctl restart wg-quick@wg0
reboot

wg show

root@debian:~# wg show
interface: wg0
  public key: fke//iPzZlH06+aj1gBjOW0ZfKZKoyQ993XrdYOeFT8=
  private key: (hidden)
  listening port: 52588

peer: BtWyS3dwdnzFbB337K3Ve+L7kOixmd26tCuTsfXYLRU=
  preshared key: (hidden)
  endpoint: 192.168.42.1:64379
  allowed ips: 10.66.66.2/32
  latest handshake: 1 minute, 41 seconds ago
  transfer: 4.08 MiB received, 334.01 KiB sent
root@debian:~# 

_______________________________________________________________________________

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ InfluxDB2 + Telegraf + Grafana (–≤–µ—Ä—Å–∏–∏ –Ω–∞–¥–æ –∞–∫—Ç—É–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –≤—Ä—É—á–Ω—É—é –Ω–∞ —Å–∞–π—Ç–∞—Ö –ø–æ –∑–∞–≥—Ä—É–∑–∫–µ)

sudo wget -q https://repos.influxdata.com/influxdata-archive_compat.key && \
sudo echo '393e8779c89ac8d958f81f942f9ad7fb82a25e133faddaf92e15b16e6ac9ce4c influxdata-archive_compat.key' | sha256sum -c && cat influxdata-archive_compat.key | gpg --dearmor | sudo tee /etc/apt/trusted.gpg.d/influxdata-archive_compat.gpg > /dev/null && \
sudo echo 'deb [signed-by=/etc/apt/trusted.gpg.d/influxdata-archive_compat.gpg] https://repos.influxdata.com/debian stable main' | sudo tee /etc/apt/sources.list.d/influxdata.list && \
sudo apt-get install -y adduser libfontconfig1 musl && \
sudo wget https://dl.grafana.com/oss/release/grafana_11.1.0_amd64.deb && \
sudo dpkg -i grafana_11.1.0_amd64.deb && \
sudo rm /root/grafana_11.1.0_amd64.deb && \
sudo systemctl enable grafana-server && \
sudo systemctl start grafana-server && \
sudo apt-get update && sudo apt-get install -y influxdb2 telegraf && \
sudo systemctl start influxd && \
sudo systemctl enable telegraf


http://192.168.42.130:8086/onboarding/2

# ZAM7zNEf3HKezSrCxEAbMQ4t3pW8-u7KcCl1fb1TqP32NYeVZMIfKVjudrl8HZLWP3BudoZBDKFNdDS3Co9U_Q==

sudo cat > /etc/telegraf/telegraf.conf <<EOF
# Configuration for telegraf agent
[agent]
  interval = "15s"
  round_interval = true
  metric_batch_size = 250
  metric_buffer_limit = 2500
  collection_jitter = "0s"
  flush_interval = "15s"
  flush_jitter = "0s"
  precision = ""
  hostname = ""
  omit_hostname = false

[[outputs.influxdb_v2]]
  urls = ["http://192.168.42.130:8086"]
  token = "ZAM7zNEf3HKezSrCxEAbMQ4t3pW8-u7KcCl1fb1TqP32NYeVZMIfKVjudrl8HZLWP3BudoZBDKFNdDS3Co9U_Q=="
  organization = "IoT"
  bucket = "IoT"

[[inputs.mqtt_consumer]]
  servers = ["tcp://192.168.42.130:1883"]
  topics = ["#"]
  username = "IoT"
  password = "123"
  data_format = "value"
  data_type = "float"
EOF


#–§–∏–∫—Å –∑–∞–ø—É—Å–∫–∞ Telegraf
sudo sed -i 14i\ 'RestartSec=2s' /lib/systemd/system/telegraf.service && \
sudo systemctl daemon-reload


# #Grafana –Ω–∞ 80 –ø–æ—Ä—Ç (–≤–º–µ—Å—Ç–æ 3000) - –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –±–µ–∑ —É–∫–∞–∑–∞–Ω–∏—è –ø–æ—Ä—Ç–∞
# sudo sed -i 's/;http_port = 3000/http_port = 80/' /etc/grafana/grafana.ini && \
# sudo sed -i 52i\ 'CapabilityBoundingSet=CAP_NET_BIND_SERVICE' /lib/systemd/system/grafana-server.service && \
# sudo sed -i 53i\ 'AmbientCapabilities=CAP_NET_BIND_SERVICE' /lib/systemd/system/grafana-server.service && \
# sudo sed -i 54i\ 'PrivateUsers=false' /lib/systemd/system/grafana-server.service && \
# sudo systemctl daemon-reload && \
# sudo systemctl restart grafana-server




# node-red-contrib-influxdb
# random-generator_node-red-contrib

```
</details>

1. –¢–∞–∫ –∫–∞–∫ —è –∑–∞ NAT–æ–º –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ (CGNAT), –Ω—É–∂–Ω–æ —á—Ç–æ-—Ç–æ –ø—Ä–∏–¥—É–º–∞—Ç—å –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ —á–µ—Ä–µ–∑ –∏–Ω–µ—Ç: 
```ps1
PS C:\Users\Fred> tracert 8.8.8.8
–¢—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞ –º–∞—Ä—à—Ä—É—Ç–∞ –∫ dns.google [8.8.8.8]
—Å –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–º —á–∏—Å–ª–æ–º –ø—Ä—ã–∂–∫–æ–≤ 30:

  1     1 ms     1 ms     1 ms  192.168.0.1
  2     1 ms     2 ms     1 ms  dsldevice.lan [192.168.1.254]
  3     4 ms     2 ms     4 ms  10.104.0.1
  4     5 ms     4 ms     4 ms  172.20.23.73
  5     5 ms     4 ms     4 ms  172.20.23.126
  6     *        *        *     –ü—Ä–µ–≤—ã—à–µ–Ω –∏–Ω—Ç–µ—Ä–≤–∞–ª –æ–∂–∏–¥–∞–Ω–∏—è –¥–ª—è –∑–∞–ø—Ä–æ—Å–∞.
  7     *        *        *     –ü—Ä–µ–≤—ã—à–µ–Ω –∏–Ω—Ç–µ—Ä–≤–∞–ª –æ–∂–∏–¥–∞–Ω–∏—è –¥–ª—è –∑–∞–ø—Ä–æ—Å–∞.
  8    67 ms    78 ms    99 ms  209.85.143.20
  9     *        *       74 ms  142.251.238.82

```

2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–±—Ö–æ–¥–Ω—ã–µ –ø—É—Ç–∏ (—Ç.–∫ –±–µ–ª—ã–π IP –Ω–µ –¥–∞—é—Ç)

| –ú–µ—Ç–æ–¥                       | –û–ø–∏—Å–∞–Ω–∏–µ                                                                                  |
| --------------------------- | ----------------------------------------------------------------------------------------- |
| üß© **Ngrok**                | –°–æ–∑–¥–∞—ë—Ç —Ç—É–Ω–Ω–µ–ª—å –∫ localhost ([https://ngrok.com](https://ngrok.com))                      |
| üåê **ZeroTier**             | –í–∏—Ä—Ç—É–∞–ª—å–Ω–∞—è P2P-—Å–µ—Ç—å —Å –¥–æ—Å—Ç—É–ø–æ–º –∫–∞–∫ –ø–æ LAN ([https://zerotier.com](https://zerotier.com)) |
| üß± **FRP / Remote.it**      | –£–º–Ω—ã–µ –ø—Ä–æ–±—Ä–æ—Å—ã –ø–æ—Ä—Ç–æ–≤ —á–µ—Ä–µ–∑ –≤–Ω–µ—à–Ω–∏–π —Å–µ—Ä–≤–µ—Ä (–ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è dev/prod)                        |
| ‚òÅ **VPS (–æ–±–ª–∞—á–Ω—ã–π —Å–µ—Ä–≤–µ—Ä)** | –ü—Ä–æ–±—Ä–∞—Å—ã–≤–∞–µ—à—å –ø–æ—Ä—Ç —Å VPS –Ω–∞ —Å–µ–±—è —á–µ—Ä–µ–∑ SSH-—Ç—É–Ω–Ω–µ–ª—å (–¥–æ—Ä–æ–∂–µ, –Ω–æ –Ω–∞–¥—ë–∂–Ω–æ)                   |

2. 1 –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Ngrok —á–µ—Ä–µ–∑ Chocolatey

```ps1
choco -v
Set-ExecutionPolicy Bypass -Scope Process -Force;
[System.Net.ServicePointManager]::SecurityProtocol = [System.Net.ServicePointManager]::SecurityProtocol -bor 3072;
iex ((New-Object System.Net.WebClient).DownloadString('https://community.chocolatey.org/install.ps1'))

choco -v

choco install ngrok -y
ngrok config add-authtoken "_here_my_token_"

# ------------------------------------------------
ngrok http 192.168.42.130:1880

#-------------------------------------------------

ngrok                                                                                                                                                                                          (Ctrl+C to quit)                                                                                                                                                                                                               ÔøΩ  Using ngrok for OSS? Request a community license: https://ngrok.com/r/oss 

Session Status                online                                                                                                                                                                           Account                       Fred (Plan: Free)                                                                                                                                                                Update                        update available (version 3.23.1, Ctrl-U to update)                                                                                                                              Version                       3.22.1                                                                                                                                                                           Region                        Europe (eu)                                                                                                                                                                      Latency                       72ms                                                                                                                                                                             Latency                       249ms                                                                                                                                                                            Web Interface                 http://127.0.0.1:4040                                                                                                                                                            Forwarding                    https://4e9d-188-253-216-66.ngrok-free.app -> http://192.168.42.130:1880                                                                                                                                                                                                                                                                                                                        Connections                   ttl     opn     rt1     rt5     p50     p90                                                                                                                                                                    66      1       0.00    0.00    0.82    6.52                                                                                                                                                                                                                                                                                                                                                    HTTP Requests                                                                                                                                                                                                  -------------                                                                                                                                                                                                                                                                                                                                                                                                                 20:55:24.332 +55 GET  /comms                                        101 Switching Protocols                                                                                                                    20:39:50.848 +39 POST /inject/c5d2858f03a8359c                      200 OK                                                                                                                                     20:34:51.939 +34 POST /inject/c5d2858f03a8359c                      200 OK                                                                                                                                     20:34:39.425 +34 GET  /icons/node-red/watch.svg                     200 OK 
```

3. –Ω–µ–º–Ω–æ–≥–æ –∏–∑–º–µ–Ω–∏–ª ngrok, –¥–æ–±–∞–≤–∏–ª  ngrok.yml:

```yaml
version: 2
authtoken: my_token

tunnels:
  node_red:
    proto: http
    addr: 192.168.42.130:1880

  influxdb:
    proto: http
    addr: 192.168.42.130:8086

  grafana:
    proto: http
    addr: 192.168.42.130:3000

```
* –ó–∞–ø—É—Å–∫
```ps1
ngrok start --all
ngrok start --all --config D:\IoT_start\Introduction_to_IoT\Seminar_1\.ngrok2\ngrok.yml
```
```ps1
Session Status                online                                                                                                                                                            Account                       Fred (Plan: Free)                                                                                                                                                 Update                        update available (version 3.23.1, Ctrl-U to update)                                                                                                               Version                       3.22.1                                                                                                                                                            Region                        Europe (eu)                                                                                                                                                       Latency                       83ms                                                                                                                                                              Web Interface                 http://127.0.0.1:4040                                                                                                                                             Forwarding                    https://1215-188-253-216-66.ngrok-free.app -> http://192.168.42.130:8086                                                                                          Forwarding                    https://5f0e-188-253-216-66.ngrok-free.app -> http://192.168.42.130:3000                                                                                          Forwarding                    https://7da7-188-253-216-66.ngrok-free.app -> http://192.168.42.130:1880 

```
* –î–æ–±–∞–≤–∏–ª –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–∫—Ä–∏–ø—Ç–æ–≤ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:
 1. DNS: (dns)[]
 2. DNS_ping: (dns_ping)[]
 3. port_checker: (port_checker)[]
 4. Speed_test: (speed_test)[]
 * –î–ª—è —Å–æ–∑–¥–∞–Ω–∏—è pdf –∏–∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π('.png', '.jpg', '.jpeg', '.gif', '.bmp')
 5. pdf_creator: (pdf_creator)[]







